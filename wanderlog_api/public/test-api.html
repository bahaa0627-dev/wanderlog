<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            color: #333;
        }
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        .success {
            color: #28a745;
            font-weight: 600;
        }
        .error {
            color: #dc3545;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>ğŸ” API æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯• 1: åŸºç¡€ API è°ƒç”¨</h2>
        <button onclick="testBasicAPI()">æµ‹è¯• /api/public-places</button>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 2: å¸¦åˆ†ç±»ç­›é€‰</h2>
        <button onclick="testCategoryFilter()">æµ‹è¯• category=museum</button>
        <button onclick="testCategorySlugFilter()">æµ‹è¯• categorySlug=museum</button>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 3: ç­›é€‰é€‰é¡¹</h2>
        <button onclick="testFilterOptions()">æµ‹è¯• /api/public-places/filter-options</button>
        <div id="test3-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 4: æ£€æŸ¥æ•°æ®å­—æ®µ</h2>
        <button onclick="testDataFields()">æ£€æŸ¥ç¬¬ä¸€æ¡æ•°æ®çš„å­—æ®µ</button>
        <div id="test4-result"></div>
    </div>

    <script>
        async function testBasicAPI() {
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>';
            
            try {
                const response = await fetch('/api/public-places?limit=5');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">âœ… æˆåŠŸï¼</p>
                        <p>æ€»æ•°: ${data.pagination.total}</p>
                        <p>è¿”å›: ${data.data.length} æ¡</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">âŒ å¤±è´¥: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        async function testCategoryFilter() {
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>';
            
            try {
                const response = await fetch('/api/public-places?category=museum&limit=5');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">âœ… æˆåŠŸï¼</p>
                        <p>æ€»æ•°: ${data.pagination.total}</p>
                        <p>è¿”å›: ${data.data.length} æ¡</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">âŒ å¤±è´¥: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        async function testCategorySlugFilter() {
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>';
            
            try {
                const response = await fetch('/api/public-places?categorySlug=museum&limit=5');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">âœ… æˆåŠŸï¼</p>
                        <p>æ€»æ•°: ${data.pagination.total}</p>
                        <p>è¿”å›: ${data.data.length} æ¡</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">âŒ å¤±è´¥: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        async function testFilterOptions() {
            const resultDiv = document.getElementById('test3-result');
            resultDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>';
            
            try {
                const response = await fetch('/api/public-places/filter-options');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">âœ… æˆåŠŸï¼</p>
                        <p>å›½å®¶æ•°: ${data.data.countries?.length || 0}</p>
                        <p>åŸå¸‚æ•°: ${data.data.cities?.length || 0}</p>
                        <p>åˆ†ç±»æ•°: ${data.data.categories?.length || 0}</p>
                        <p>æ ‡ç­¾æ•°: ${data.data.tags?.length || 0}</p>
                        <p>æ¥æºæ•°: ${data.data.sources?.length || 0}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">âŒ å¤±è´¥: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        async function testDataFields() {
            const resultDiv = document.getElementById('test4-result');
            resultDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>';
            
            try {
                const response = await fetch('/api/public-places?limit=1');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const place = data.data[0];
                    const fields = Object.keys(place);
                    
                    resultDiv.innerHTML = `
                        <p class="success">âœ… æˆåŠŸï¼</p>
                        <p>å­—æ®µæ•°: ${fields.length}</p>
                        <p>å­—æ®µåˆ—è¡¨:</p>
                        <ul>
                            ${fields.map(f => `<li><strong>${f}</strong>: ${typeof place[f]} = ${JSON.stringify(place[f]).substring(0, 100)}</li>`).join('')}
                        </ul>
                        <p>å®Œæ•´æ•°æ®:</p>
                        <pre>${JSON.stringify(place, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">âŒ å¤±è´¥: ${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>

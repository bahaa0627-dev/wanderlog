#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘           ğŸ“± iOS ç”¨æˆ·æ³¨å†Œæµç¨‹æµ‹è¯•å‡†å¤‡                        â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# æ£€æŸ¥ API æœåŠ¡
echo "ğŸ” æ£€æŸ¥ API æœåŠ¡çŠ¶æ€..."
if lsof -Pi :3000 -sTCP:LISTEN -t >/dev/null ; then 
  echo "âœ… API æœåŠ¡æ­£åœ¨è¿è¡Œåœ¨ç«¯å£ 3000"
else 
  echo "âŒ API æœåŠ¡æœªè¿è¡Œ"
  echo ""
  echo "è¯·å…ˆå¯åŠ¨ API æœåŠ¡ï¼š"
  echo "   cd wanderlog_api && npm run dev"
  echo ""
  exit 1
fi

echo ""

# æ¸…ç†æµ‹è¯•ç”¨æˆ·
echo "ğŸ§¹ æ¸…ç†ä¹‹å‰çš„æµ‹è¯•ç”¨æˆ·..."
cd "$(dirname "$0")/wanderlog_api"
npx tsx cleanup_test_user.ts

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… å‡†å¤‡å°±ç»ªï¼ç°åœ¨å¯ä»¥å¼€å§‹ iOS æµ‹è¯•äº†"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“± æ­¥éª¤ 1: å¯åŠ¨ iOS åº”ç”¨"
echo "   cd wanderlog_app"
echo "   flutter run"
echo ""
echo "ğŸ“ æ­¥éª¤ 2: åœ¨åº”ç”¨ä¸­æ³¨å†Œæ–°ç”¨æˆ·"
echo "   Email:    blcubahaa0627@gmail.com"
echo "   Password: Test123456"
echo "   Name:     Test User (å¯é€‰)"
echo ""
echo "ğŸ“§ æ­¥éª¤ 3: è·å–éªŒè¯ç "
echo ""
echo "   æ–¹æ³• 1: æ£€æŸ¥é‚®ç®±"
echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "   æ‰“å¼€é‚®ç®± blcubahaa0627@gmail.com æŸ¥çœ‹éªŒè¯é‚®ä»¶"
echo ""
echo "   æ–¹æ³• 2: ä½¿ç”¨ Prisma Studio"
echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "   cd wanderlog_api && npx prisma studio"
echo "   è®¿é—® http://localhost:5555"
echo "   æŸ¥çœ‹ VerificationToken è¡¨"
echo ""
echo "   æ–¹æ³• 3: å‘½ä»¤è¡ŒæŸ¥è¯¢"
echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "   cd wanderlog_api"
echo "   npx tsx -e \""
echo "   import { PrismaClient } from '@prisma/client';"
echo "   const prisma = new PrismaClient();"
echo "   const token = await prisma.verificationToken.findFirst({"
echo "     where: { "
echo "       user: { email: 'blcubahaa0627@gmail.com' },"
echo "       type: 'EMAIL_VERIFICATION'"
echo "     },"
echo "     orderBy: { createdAt: 'desc' }"
echo "   });"
echo "   console.log('éªŒè¯ç :', token?.token);"
echo "   await prisma.\$disconnect();"
echo "   \""
echo ""
echo "âœ‰ï¸ æ­¥éª¤ 4: åœ¨åº”ç”¨ä¸­è¾“å…¥éªŒè¯ç "
echo "   åœ¨ 6 ä¸ªè¾“å…¥æ¡†ä¸­è¾“å…¥éªŒè¯ç "
echo "   è¾“å…¥å®Œæˆåä¼šè‡ªåŠ¨éªŒè¯"
echo ""
echo "ğŸ‰ æ­¥éª¤ 5: éªŒè¯æˆåŠŸ"
echo "   åº”è¯¥è‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µ"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ’¡ æç¤ºï¼š"
echo "   - API æ—¥å¿—ä¼šå®æ—¶æ˜¾ç¤ºæ³¨å†Œå’ŒéªŒè¯è¯·æ±‚"
echo "   - éªŒè¯ç æœ‰æ•ˆæœŸä¸º 15 åˆ†é’Ÿ"
echo "   - å¯ä»¥ç‚¹å‡» 'Resend Code' é‡æ–°å‘é€éªŒè¯ç "
echo ""
echo "ğŸ“– è¯¦ç»†æŒ‡å—ï¼šIOS_REGISTRATION_TEST_GUIDE.md"
echo ""
